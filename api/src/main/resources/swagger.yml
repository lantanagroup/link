openapi: 3.0.1
info:
  version: ''
  title: Link API
servers:
  - url: ''
    description: This server
security:
  - oauth: []
  - basic: [ ]
tags:
  - name: API Root
    description: The root endpoint of the API
paths:
  /api:
    get:
      tags:
        - API Root
      summary: Gets version information about this installation of Link's API
      operationId: getVersionInfo
      responses:
        '200':
          description: successful response
          content:
            'application/json':
              schema:
                type: string
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
      security:
        - { }
  /api/$tenant-schema:
    get:
      tags:
        - API Root
      summary: Gets the JSON schema specification of the Tenant configuration
      operationId: getTenantJsonSchema
      responses:
        '200':
          description: successful response
          content:
            'application/json':
              schema:
                $ref: '#/components/schemas/ApiInfoModel'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
      security:
        - { }
  /api/docs:
    get:
      tags:
        - API Root
      summary: The swagger spec document for this Link's API
      operationId: getDocs
      responses:
        '200':
          description: successful response
          content:
            text/yaml:
              schema:
                type: string
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
      security:
        - { }
  /api/user:
    get:
      tags:
        - Users
      summary: Search all users
      operationId: searchUsers
      parameters:
        - name: includeDisabled
          in: query
          description: Whether or not to include disabled users
          schema:
            type: boolean
      responses:
        '200':
          description: successful response
          content:
            'application/json':
              schema:
                $ref: '#/components/schemas/User'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
    post:
      tags:
        - Users
      summary: Create a new user
      operationId: createUser
      requestBody:
        description: 'A user object created'
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/User'
      responses:
        '200':
          description: successful response
          content:
            'application/json':
              schema:
                $ref: '#/components/schemas/User'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
  /api/user/$bulk:
    post:
      tags:
        - Users
      summary: Create a new user
      operationId: createBulkUsers
      requestBody:
        description: 'An array of user objects that should be created'
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: '#/components/schemas/User'
      responses:
        '200':
          description: successful response
          content:
            'application/json':
              schema:
                $ref: '#/components/schemas/FHIR.BulkCreateUserOperationOutcome'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
  /api/user/{userId}:
    put:
      tags:
        - Users
      summary: Update a user
      operationId: updateUser
      parameters:
        - name: userId
          in: path
          description: The id of the user to update
          required: true
          schema:
            type: string
      requestBody:
        description: 'The "enabled" property of the User is ignored. It can only be set via DELETE'
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/User'
      responses:
        '200':
          description: successful response
          content:
            'application/json':
              schema:
                $ref: '#/components/schemas/User'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
    delete:
      tags:
        - Users
      summary: Delete (disable) a user
      operationId: deleteUser
      parameters:
        - name: userId
          in: path
          description: The id of the user to delete/disable
          required: true
          schema:
            type: string
      responses:
        '204':
          description: successful response
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
  /api/user/{userId}/$change-password:
    put:
      tags:
        - Users
      summary: Change a user's password
      operationId: changeUserPassword
      parameters:
        - name: userId
          in: path
          description: The id of the user to update
          required: true
          schema:
            type: string
      requestBody:
        content:
          text/plain:
            schema:
              type: string
      responses:
        '200':
          description: successful response
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
  /api/tenant:
    get:
      tags:
        - Tenants
      summary: Search all tenants
      operationId: searchTenants
      responses:
        '200':
          description: successful response
          content:
            'application/json':
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/SearchTenantResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
    post:
      tags:
        - Tenants
      summary: Create a new tenant. If id is specified, will make sure that the tenant does not already exist and then create the tenant with the specified id
      operationId: createTenant
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Tenant'
          'application/x-yaml':
            schema:
              $ref: '#/components/schemas/Tenant'
      responses:
        '200':
          description: successful response
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
  /api/tenant/{id}:
    get:
      tags:
        - Tenants
      summary: Get a single tenant
      operationId: getTenant
      parameters:
        - name: id
          in: path
          description: The id of the tenant
          required: true
          schema:
            type: string
      responses:
        '200':
          description: successful response
          content:
            'application/json':
              schema:
                $ref: '#/components/schemas/Tenant'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
    put:
      tags:
        - Tenants
      summary: Updates an existing tenant
      operationId: updateTenant
      parameters:
        - name: id
          in: path
          description: The id of the tenant
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Tenant'
          'application/x-yaml':
            schema:
              $ref: '#/components/schemas/Tenant'
      responses:
        '200':
          description: successful response
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
    delete:
      tags:
        - Tenants
      summary: Delete a tenant
      operationId: deleteTenant
      parameters:
        - name: id
          in: path
          description: The id of the tenant
          required: true
          schema:
            type: string
      responses:
        '204':
          description: successful response with no content returned
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
  /api/{tenantId}/poi:
    get:
      tags:
        - Patient Identification
      summary: Search patient lists
      operationId: searchPatientLists
      parameters:
        - name: tenantId
          in: path
          description: The id of the tenant
          required: true
          schema:
            type: string
      responses:
        '200':
          description: successful response
          content:
            'application/json':
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/PatientList'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
  /api/{tenantId}/poi/{id}:
    get:
      tags:
        - Patient Identification
      summary: Get one patient list
      operationId: getPatientList
      parameters:
        - name: tenantId
          in: path
          description: The id of the tenant
          required: true
          schema:
            type: string
        - name: id
          in: path
          description: The id of the patient list to retrieve
          required: true
          schema:
            type: string
      responses:
        '200':
          description: successful response
          content:
            'application/json':
              schema:
                $ref: '#/components/schemas/PatientList'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
  /api/{tenantId}/poi/fhir/List:
    post:
      tags:
        - Patient Identification
      summary: Submit a FHIR List of patients to be included in report generation
      description: Measure and reporting period are derived from extensions in the List
      operationId: saveFhirList
      parameters:
        - name: tenantId
          in: path
          description: The id of the tenant
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              type: string
          application/xml:
            schema:
              type: string
      responses:
        '200':
          description: successful response
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
  /api/{tenantId}/poi/$query-list:
    get:
      tags:
        - Patient Identification
      summary: Query the EHR's FHIR API for a real-time patient list and persist the patient identifiers
      operationId: queryPatientList
      parameters:
        - name: tenantId
          in: path
          description: The id of the tenant
          required: true
          schema:
            type: string
      responses:
        '200':
          description: successful response
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
  /api/{tenantId}/report/$generate:
    post:
      tags:
        - Reports
      summary: Generate a report for given criteria
      description: Generates a report based on the specified measure and reporting period criteria. Report generation can take time to respond, as it involves querying the configured EHR for data related to the patients identified for the criteria.
      operationId: generateReport_1
      parameters:
        - name: tenantId
          in: path
          description: The id of the tenant
          required: true
          schema:
            type: string
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GenerateRequest'
      responses:
        '200':
          description: successful response
          content:
            'application/json':
              schema:
                $ref: '#/components/schemas/Report'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
  /api/{tenantId}/report/$generateMultiMeasure:
    post:
      tags:
        - Reports
      summary: Generate a report for given criteria
      description: Generates a report based on the specified measure and reporting period criteria. Report generation can take time to respond, as it involves querying the configured EHR for data related to the patients identified for the criteria.
      operationId: generateReport_2
      parameters:
        - name: tenantId
          in: path
          description: The id of the tenant
          required: true
          schema:
            type: string
        - name: multiMeasureBundleId
          in: query
          description: The id of the multi measure package/bundle
          required: true
          schema:
            type: string
        - name: periodStart
          in: query
          description: The start date of the reporting period, formatted as a FHIR datetime
          required: true
          schema:
            type: string
        - name: periodEnd
          in: query
          description: The end date of the reporting period, formatted as a FHIR datetime
          required: true
          schema:
            type: string
        - name: regenerate
          in: query
          description: Whether to regenerate the report if a report with the same criteria already exists
          required: true
          schema:
            type: boolean
      responses:
        '200':
          description: successful response
          content:
            'application/json':
              schema:
                $ref: '#/components/schemas/Report'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
  /api/{tenantId}/report/{reportId}/$send:
    post:
      tags:
        - Reports
      summary: Send/submit the specified report to the consumer/recipient
      operationId: send
      parameters:
        - name: tenantId
          in: path
          description: The id of the tenant
          required: true
          schema:
            type: string
        - name: reportId
          in: path
          description: The logical id of the report to submit
          required: true
          schema:
            type: string
        - name: download
          in: query
          description: Whether to echo the report to the client
          required: false
          schema:
            type: boolean
      responses:
        '200':
          description: successful response
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
  /api/{tenantId}/report/{reportId}/aggregate:
    get:
      tags:
        - Reports
      summary: Get the aggregate measure report(s) generated the specified report id
      operationId: getReportAggregates
      parameters:
        - name: tenantId
          in: path
          description: The id of the tenant
          required: true
          schema:
            type: string
        - name: reportId
          in: path
          description: The id of the report
          required: true
          schema:
            type: string
      responses:
        '200':
          description: A list of FHIR MeasureReports
          content:
            'application/json':
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/FHIR.MeasureReport'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
  /api/{tenantId}/report/{reportId}/patientList:
    get:
      tags:
        - Reports
      summary: Get the patient list(s) used to generate the specified report id
      operationId: getReportPatientLists
      parameters:
        - name: tenantId
          in: path
          description: The id of the tenant
          required: true
          schema:
            type: string
        - name: reportId
          in: path
          description: The id of the report
          required: true
          schema:
            type: string
      responses:
        '200':
          description: successful response
          content:
            'application/json':
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/PatientList'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
  /api/{tenantId}/report/{reportId}/individual:
    get:
      tags:
        - Reports
      summary: Get all individuals' patient measure reports generated for the specified report id
      operationId: getPatientMeasureReports
      parameters:
        - name: tenantId
          in: path
          description: The id of the tenant
          required: true
          schema:
            type: string
        - name: reportId
          in: path
          description: The id of the report
          required: true
          schema:
            type: string
      responses:
        '200':
          description: All individuals' FHIR MeasureReport
          content:
            'application/json':
              schema:
                $ref: '#/components/schemas/FHIR.MeasureReport'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
  /api/{tenantId}/report/{reportId}/individual/{patientMeasureReportId}:
    get:
      tags:
        - Reports
      summary: Get an individual's patient measure report generated for the specified report id
      operationId: getPatientMeasureReport
      parameters:
        - name: tenantId
          in: path
          description: The id of the tenant
          required: true
          schema:
            type: string
        - name: reportId
          in: path
          description: The id of the report
          required: true
          schema:
            type: string
        - name: patientMeasureReportId
          in: path
          description: The id of the patient measure report
          required: true
          schema:
            type: string
      responses:
        '200':
          description: A individual's FHIR MeasureReport
          content:
            'application/json':
              schema:
                $ref: '#/components/schemas/FHIR.MeasureReport'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
  /api/{tenantId}/validate:
    post:
      tags:
        - Validation
      summary: Validate a report provided in the request body
      operationId: validateRequest
      parameters:
        - name: tenantId
          in: path
          description: The id of the tenant, used to determine validation options
          required: true
          schema:
            type: string
        - name: severity
          in: query
          schema:
            type: string
            default: ERROR
            enum: [ ERROR, WARN, INFO ]
      requestBody:
        description: The FHIR Bundle to validate
        required: true
        content:
          'application/json':
            schema:
              $ref: '#/components/schemas/FHIR.Bundle'
      responses:
        '200':
          description: successful response
          content:
            'application/json':
              schema:
                $ref: '#/components/schemas/FHIR.OperationOutcome'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
  /api/{tenantId}/validate/summary:
    post:
      tags:
        - Validation
      summary: Provides a summary of unique messages from validation results of the request body
      operationId: validateRequestSummary
      parameters:
        - name: tenantId
          in: path
          description: The id of the tenant in which the report resides, and used to determine validation options
          required: true
          schema:
            type: string
        - name: severity
          in: query
          schema:
            type: string
            default: ERROR
            enum: [ ERROR, WARN, INFO ]
      requestBody:
        description: The FHIR Bundle to validate
        required: true
        content:
          'application/json':
            schema:
              $ref: '#/components/schemas/FHIR.Bundle'
      responses:
        '200':
          description: successful response
          content:
            'text/plain':
              schema:
                type: string
                example: |
                  * Device.deviceName.type: minimum required = 1, but only found 0 (from http://hl7.org/fhir/StructureDefinition/Device)
                  * Slicing cannot be evaluated: Problem with use of resolve() - profile [CanonicalType[http://hl7.org/fhir/us/cqfmeasures/StructureDefinition/cqfm-softwaresystem]] on MeasureReport.extension:software could not be resolved (@char 1)
                  * MedicationRequest.requester: minimum required = 1, but only found 0 (from http://hl7.org/fhir/us/core/StructureDefinition/us-core-medicationrequest)
                  * if a date has a time, it must have a timezone
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
  /api/{tenantId}/validate/{reportId}:
    get:
      tags:
        - Validation
      summary: Validate a generated report
      operationId: validateReport
      parameters:
        - name: tenantId
          in: path
          description: The id of the tenant in which the report resides, and used to determine validation options
          required: true
          schema:
            type: string
        - name: reportId
          in: path
          description: The logical id of the report to submit
          required: true
          schema:
            type: string
        - name: severity
          in: query
          schema:
            type: string
            default: ERROR
            enum: [ ERROR, WARN, INFO ]
      responses:
        '200':
          description: successful response
          content:
            'application/json':
              schema:
                $ref: '#/components/schemas/FHIR.OperationOutcome'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
  /api/{tenantId}/validate/{reportId}/summary:
    get:
      tags:
        - Validation
      summary: Provides a summary of unique messages from validation results
      operationId: validateReportSummary
      parameters:
        - name: tenantId
          in: path
          description: The id of the tenant in which the report resides, and used to determine validation options
          required: true
          schema:
            type: string
        - name: reportId
          in: path
          description: The logical id of the report to submit
          required: true
          schema:
            type: string
        - name: severity
          in: query
          schema:
            type: string
            default: ERROR
            enum: [ ERROR, WARN, INFO ]
      responses:
        '200':
          description: successful response
          content:
            'text/plain':
              schema:
                type: string
                example: |
                  * Device.deviceName.type: minimum required = 1, but only found 0 (from http://hl7.org/fhir/StructureDefinition/Device)
                  * Slicing cannot be evaluated: Problem with use of resolve() - profile [CanonicalType[http://hl7.org/fhir/us/cqfmeasures/StructureDefinition/cqfm-softwaresystem]] on MeasureReport.extension:software could not be resolved (@char 1)
                  * MedicationRequest.requester: minimum required = 1, but only found 0 (from http://hl7.org/fhir/us/core/StructureDefinition/us-core-medicationrequest)
                  * if a date has a time, it must have a timezone
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
  /api/measureDef:
    get:
      tags:
        - Measure Definitions
      summary: Search measure definitions loaded in Link
      operationId: searchMeasureDefinitions
      responses:
        '200':
          description: successful response
          content:
            'application/json':
              schema:
                $ref: '#/components/schemas/MeasureDefinition'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
    put:
      tags:
        - Measure Definitions
      summary: Loads the measure bundle from the request into Link. Either the request body must have a FHIR Bundle, or the url parameter must be specified.
      operationId: createOrUpdateMeasureDef
      parameters:
        - name: measureId
          in: query
          description: The ID of a measure that should be loaded. The ID specified represents a URL in the system config.
          required: false
          schema:
            type: string
      requestBody:
        required: false
        content:
          'application/json':
            schema:
              $ref: '#/components/schemas/FHIR.Bundle'
      responses:
        '200':
          description: successful response
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
  /api/measureDef/{measureId}:
    delete:
      tags:
        - Measure Definitions
      summary: Loads the measure bundle from the request into Link. Either the request body must have a FHIR Bundle, or the url parameter must be specified.
      operationId: deleteMeasureDef
      parameters:
        - name: measureId
          in: path
          description: The measureId of the measure definition to be deleted
          required: true
          schema:
            type: string
      responses:
        '204':
          description: successful response with no content returned
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
  /api/measurePackage:
    get:
      tags:
        - Measure Packages
      summary: Search measure packages
      operationId: searchMeasurePackages
      responses:
        '200':
          description: successful response
          content:
            'application/json':
              schema:
                $ref: '#/components/schemas/MeasurePackage'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
    put:
      tags:
        - Measure Packages
      summary: Saves a measure package
      operationId: createOrUpdateMeasurePackage
      requestBody:
        required: false
        content:
          'application/json':
            schema:
              $ref: '#/components/schemas/MeasurePackage'
      responses:
        '200':
          description: successful response
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
  /api/measurePackage/{id}:
    delete:
      tags:
        - Measure Packages
      summary: Deletes a measure package
      operationId: deleteMeasurePackage
      parameters:
        - name: id
          in: path
          description: The id of the measure package to be deleted
          required: true
          schema:
            type: string
      responses:
        '204':
          description: successful response with no content returned
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
  /api/{tenantId}/conceptMap:
    put:
      tags:
        - Concept Maps
      summary: Creates or updates a concept map
      operationId: createOrUpdateConceptMap
      parameters:
        - name: tenantId
          in: path
          description: The id of the tenant
          required: true
          schema:
            type: string
      requestBody:
        content:
          'application/json':
            schema:
              $ref: '#/components/schemas/ConceptMap'
      responses:
        '200':
          description: successful response
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
    get:
      tags:
        - Concept Maps
      summary: Searches concept maps for the specified tenant
      operationId: searchConceptMap
      parameters:
        - name: tenantId
          in: path
          description: The id of the tenant
          required: true
          schema:
            type: string
      responses:
        '200':
          description: successful response
          content:
            'application/json':
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ConceptMapItem'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
  /api/{tenantId}/conceptMap/{id}:
    get:
      tags:
        - Concept Maps
      summary: Retrievse a specific concept map from the tenant
      operationId: getConceptMap
      parameters:
        - name: tenantId
          in: path
          description: The id of the tenant
          required: true
          schema:
            type: string
        - name: id
          in: path
          description: The id of the concept map to retrieve
          required: true
          schema:
            type: string
      responses:
        '200':
          description: successful response
          content:
            'application/json':
              schema:
                $ref: '#/components/schemas/ConceptMap'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
  /api/{tenantId}/data/$expunge:
    delete:
      tags:
        - Data
      summary: Expunges/deletes any data that has passed the tenant's configured retention
      operationId: expungeData
      parameters:
        - name: tenantId
          in: path
          description: The id of the tenant
          required: true
          schema:
            type: string
      responses:
        '200':
          description: successful response
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
  /api/{tenantId}/data/$test-fhir:
    get:
      tags:
        - Data
      summary: Tests the connectivity to the tenant's configured fhir server
      description: Performs a basic integration test against the tenant's configured FHIR server. Either `patientId` or `patientIdentifier` is required.
      operationId: test
      parameters:
        - name: tenantId
          in: path
          description: The id of the tenant
          required: true
          schema:
            type: string
        - name: patientId
          in: query
          description: The logical FHIR ID of a Patient
          example: Patient/123
          schema:
            type: string
        - name: patientIdentifier
          in: query
          description: The business ID of a Patient
          example: http://some-system|321
          schema:
            type: string
        - name: measureId
          in: query
          description: The ID of the measure that should be used to determine the query method for the integration test
          example: NHSNGlycemicControlHypoglycemicInitialPopulation
          required: true
          schema:
            type: string
        - name: periodStart
          in: query
          description: The ISO formatted (FHIR) date for the reporting period's start
          example: 2022-01-01T00:00:00.000Z
          required: true
          schema:
            type: string
        - name: periodEnd
          in: query
          description: The ISO formatted (FHIR) date for the reporting period's end
          example: 2022-01-31T23:59:59.000Z
          required: true
          schema:
            type: string
      responses:
        '200':
          description: successful response
          content:
            'application/json':
              schema:
                $ref: '#/components/schemas/TestResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
  /api/{tenantId}/bulk/$initiate-bulk-data:
    post:
      tags:
        - Bulk
      summary: Initiates the Bulk Data Export process.
      parameters:
        - name: tenantId
          in: path
          description: The id of the tenant
          required: true
          schema:
            type: string
      responses:
        '200':
          description: successful response
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
  /api/{tenantId}/bulk/status/{id}:
    get:
      tags:
        - Bulk
      summary: Gets a bulk status by id
      parameters:
        - name: tenantId
          in: path
          description: The id of the tenant
          required: true
          schema:
            type: string
        - name: id
          in: path
          description: the id of the bulk status record
          required: true
          schema:
            type: string
      responses:
        '200':
          description: successful response
          content:
            'application/json':
              schema:
                $ref: '#/components/schemas/BulkStatus'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
  /api/{tenantId}/bulk/$execute-query-and-retrieval:
    post:
      tags:
        - Bulk
      summary: Pulls all pending bulk statuses and fetches results.
      parameters:
        - name: tenantId
          in: path
          description: The id of the tenant
          required: true
          schema:
            type: string
      responses:
        '200':
          description: successful response
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
components:
  schemas:
    ApiInfoModel:
      type: object
      properties:
        build:
          type: string
        version:
          type: string
    PatientId:
      type: object
      properties:
        reference:
          type: string
        identifier:
          type: string
    PatientList:
      type: object
      properties:
        id:
          type: string
        periodStart:
          type: string
        periodEnd:
          type: string
        measureId:
          type: string
        lastUpdated:
          type: string
        patients:
          type: array
          items:
            $ref: '#/components/schemas/PatientId'
    GenerateRequest:
      type: object
      properties:
        regenerate:
          type: boolean
        bundleIds:
          type: array
          items:
            type: string
        periodStart:
          type: string
        periodEnd:
          type: string
    Report:
      type: object
      properties:
        id:
          type: string
        measureId:
          type: array
          items:
            type: string
        periodStart:
          type: string
        periodEnd:
          type: string
        status:
          type: string
          enum:
            - Draft
            - Submitted
        submittedTime:
          type: string
        generatedTime:
          type: string
        version:
          type: string
        patientLists:
          type: array
          items:
            type: string
        aggregates:
          type: array
          items:
            type: string
    MeasureDefinition:
      type: object
      properties:
        id:
          type: string
        measureId:
          type: string
        bundle:
          $ref: '#/components/schemas/FHIR.Bundle'
        lastUpdated:
          type: string
    MeasurePackage:
      type: object
      properties:
        id:
          type: string
        measureIds:
          type: array
          items:
            type: string
    ConceptMap:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        contexts:
          type: array
          items:
            type: string
        conceptMap:
          $ref: '#/components/schemas/FHIR.ConceptMap'
    ConceptMapItem:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        contexts:
          type: array
          items:
            type: string
    BulkStatus:
      type: object
      properties:
        id:
          type: string
        tenantId:
          type: string
        statusUrl:
          type: string
        status:
          $ref: '#/components/schemas/BulkStatuses'
        lastChecked:
          type: string
    BulkStatuses:
      type: string
      enum:
        - Pending
        - InProgress
        - Complete
    TestResponse:
      type: object
      properties:
        success:
          type: boolean
        message:
          type: string
    SearchTenantResponse:
      type: object
      properties:
        id:
          type: string
          description: 'A unique ID of the tenant. Cannot contain special characters other than dashes and underscores.'
        name:
          type: string
          description: 'The internal name of the tenant, such as the facility''s name.'
        retentionPeriod:
          type: string
          description: ISO 8601 formatted duration in which to keep data for each tenant.
          default: 'P3M'
        cdcOrgId:
          type: string
          description: 'Organization ID for the tenant according to CDC. Used by the Measure Reporting Plan functionality, and when bundling to submit to NHSN; an Organization resource is created uses this as an identifier of the facility.'
    Tenant:
      type: object
      required:
        - cdcOrgId
        - bundling
      properties:
        id:
          type: string
          description: 'A unique ID of the tenant. Cannot contain special characters other than dashes and underscores.'
        name:
          type: string
          description: 'The internal name of the tenant, such as the facility''s name.'
        cdcOrgId:
          type: string
          description: 'Organization ID for the tenant according to CDC. Used by the Measure Reporting Plan functionality, and when bundling to submit to NHSN; an Organization resource is created uses this as an identifier of the facility.'
        connectionString:
          type: string
          description: 'The name of the database to use for the tenant''s PHI/PII data. The same connection string for the database server is used for each tenant, but a different database on the server is used for each tenant.'
        bundling:
          allOf:
            - $ref: '#/components/schemas/Bundling'
            - description: 'Configuration properties for how to bundle the final submission, including contact information that is used when creating an Organization resource that represents the sending facility (the tenant).'
        scheduling:
          allOf:
            - $ref: '#/components/schemas/Schedule'
            - description: Schedule configuration for the tenant that can be used to automatically begin processes such as querying for patient lists, data retention, and automatic generation and submission of reports.
        events:
          allOf:
            - $ref: '#/components/schemas/Events'
            - description: 'Custom classes/functionality that can be turned on at various points during the report generation pipeline.'
        queryList:
          allOf:
            - $ref: '#/components/schemas/QueryList'
            - description: 'Configuration that should be used for /api/{tenantId}/poi/$query-list to query the EHR''s FHIR List for patients of interest'
        fhirQuery:
          allOf:
            - $ref: '#/components/schemas/FhirQuery'
            - description: 'Configuration to use when querying patients of interest for their clinical data, such as Encounter, Condition, etc. Includes authentication strategy that is needed to successfully query the EHR''s FHIR API.'
        reportingPlan:
          allOf:
            - $ref: '#/components/schemas/ReportingPlan'
            - description: 'Configuration for how to query the MRP (reporting plan) interface at CDC/NHSN to determine if a facility/tenant is signed up to report during the calculated reporting period.'
        retentionPeriod:
          type: string
          description: ISO 8601 formatted duration in which to keep data for each tenant.
          default: 'P3M'
    Bundling:
      type: object
      required:
        - name
      properties:
        bundleType:
          type: string
          enum:
            - COLLECTION
            - BATCH
          default: COLLECTION
          description: 'The type of submission bundle to create. Bundle types are defined in https://hl7.org/fhir/codesystem-bundle-type.html'
        includesCensuses:
          type: boolean
          default: true
          description: 'Whether to include censuses in the submission bundle.'
        mergeCensuses:
          type: boolean
          default: true
          description: 'Whether to merge multiple censuses into a single list.'
        promoteLineLevelResources:
          type: boolean
          default: false
          description: 'Whether to move contained line-level resources to the top level of the submission bundle.'
        npi:
          type: string
          description: 'The National Provider Identifier (NPI) of the organization/facility the system is bundling/submitting for, to be used in the submission Bundle''s Organization.identifier field'
        name:
          type: string
          description: 'The name of the organization/facility the system is bundling/submitting for, to be used in the submission Bundle''s Organization.name field'
        phone:
          type: string
          description: 'The phone of the organization/facility the system is bundling/submitting for, to be used in the submission Bundle''s Organization.name field'
        email:
          type: string
          description: 'The email of the organization/facility the system is bundling/submitting for, to be used in the submission Bundle''s Organization.name field'
        address:
          allOf:
            - $ref: '#/components/schemas/Address'
            - description: 'The address of the organization/facility the system is bundling/submitting for, to be used in the submission Bundle''s Organization.name field'
    Address:
      type: object
      properties:
        addressLine:
          type: string
        city:
          type: string
        state:
          type: string
        postalCode:
          type: string
        country:
          type: string
    Schedule:
      type: object
      description: |
        See <a href="https://productresources.collibra.com/docs/collibra/latest/Content/Cron/co_spring-cron.htm" target="_new">Spring Cron syntax</a> for more info.<br/>
        See <a href="https://crontab.guru/" target="_new">Crontab.guru</a> for more info (note: seconds aren't accounted for in this tool).
      properties:
        queryPatientListCron:
          type: string
          description: 'The CRON-formatted schedule to use querying patient list information from the EHR. The equivalent of manually calling /api/{tenantId}/poi/$query-list. Cron expression formatting can be found in https://docs.oracle.com/cd/E12058_01/doc/doc.1014/e12030/cron_expressions.htm'
        dataRetentionCheckCron:
          type: string
          description: 'The CRON-formatted schedule to use for data retention checks (removing data that is outside the tenant''s configured retention period).'
        generateAndSubmitReports:
          type: array
          items:
            $ref: '#/components/schemas/GenerateReport'
          description: 'Configuration for when to automatically generate and submit reports.'
    GenerateReport:
      type: object
      properties:
        cron:
          type: string
          description: 'The CRON-formatted schedule to use for this report''s generation and submission'
        measureIds:
          type: array
          items:
            type: string
          description: 'The IDs of the measures to generate the report for'
        reportingPeriodMethod:
          type: string
          enum:
            - LastMonth
            - CurrentMonth
            - LastWeek
            - CurrentWeek
          description: 'The method that should be used to calculate the reporting period for the report.'
        regenerateIfExists:
          type: boolean
          default: false
          description: 'If a report already exists for the calculated reporting period and measures, indicates whether or not the report generation process should continue and overwrite the already existing report.'
    Events:
      type: object
      properties:
        BeforeMeasureResolution:
          type: array
          items:
            $ref: '#/components/schemas/EventOptions'
        AfterMeasureResolution:
          type: array
          items:
            $ref: '#/components/schemas/EventOptions'
        OnRegeneration:
          type: array
          items:
            $ref: '#/components/schemas/EventOptions'
        BeforePatientOfInterestLookup:
          type: array
          items:
            $ref: '#/components/schemas/EventOptions'
        AfterPatientOfInterestLookup:
          type: array
          items:
            $ref: '#/components/schemas/EventOptions'
        BeforePatientDataQuery:
          type: array
          items:
            $ref: '#/components/schemas/EventOptions'
        AfterPatientResourceQuery:
          type: array
          items:
            $ref: '#/components/schemas/EventOptions'
        AfterPatientDataQuery:
          type: array
          items:
            $ref: '#/components/schemas/EventOptions'
        AfterApplyConceptMaps:
          type: array
          items:
            $ref: '#/components/schemas/EventOptions'
        BeforePatientDataStore:
          type: array
          items:
            $ref: '#/components/schemas/EventOptions'
        AfterPatientDataStore:
          type: array
          items:
            $ref: '#/components/schemas/EventOptions'
        BeforeMeasureEval:
          type: array
          items:
            $ref: '#/components/schemas/EventOptions'
        AfterMeasureEval:
          type: array
          items:
            $ref: '#/components/schemas/EventOptions'
        BeforeReportStore:
          type: array
          items:
            $ref: '#/components/schemas/EventOptions'
        AfterReportStore:
          type: array
          items:
            $ref: '#/components/schemas/EventOptions'
        BeforeBundling:
          type: array
          items:
            $ref: '#/components/schemas/EventOptions'
        AfterBundling:
          type: array
          items:
            $ref: '#/components/schemas/EventOptions'
    EventOptions:
      type: string
      enum:
        - com.lantanagroup.link.events.CodeSystemCleanup
        - com.lantanagroup.link.events.ContainedResourceCleanup
        - com.lantanagroup.link.events.CopyLocationIdentifierToType
        - com.lantanagroup.link.events.EncounterStatusTransformer
        - com.lantanagroup.link.events.FixResourceId
        - com.lantanagroup.link.events.FixPeriodDates
        - com.lantanagroup.link.events.PatientDataResourceFilter
      description: >
        Event Options
          * `com.lantanagroup.link.events.CodeSystemCleanup` - Finds references to invalid code systems and replaces them with valid code systems

          * `com.lantanagroup.link.events.ContainedResourceCleanup` - Moves any contained resources from resources retrieved from the EHR to the top-level of patient data
        
          * `com.lantanagroup.link.events.CopyLocationIdentifierToType` - This is a specific transform to move data from an extension to the type of a Location resource for UMich. This must happen BEFORE ApplyConceptMaps as an event

          * `com.lantanagroup.link.events.EncounterStatusTransformer` - For each Encounter resource acquired from the EHR, it checks if an end date has been specified on the encounter. If so, changes the Encounter.status to “finished”.

          * `com.lantanagroup.link.events.FixResourceId` - Looks for resources acquired from the EHR that have id elements with a length greater than 64 characters. For those, stores the original id in an extension and replaces the id with a hash representation of the id to keep it unique, which is shorter than 64 characters.

          * `com.lantanagroup.link.events.FixPeriodDates` - Looks for started dates that have no time component. If found, the stored start date is fixed to include precision up to the seconds

          * `com.lantanagroup.link.events.PatientDataResourceFilter` - Filters patient data resources to determine which resources are applicable for the measure period.
    QueryList:
      type: object
      properties:
        fhirServerBase:
          type: string
          description: The URL to the facility FHIR endpoint
        lists:
          type: array
          items:
            $ref: '#/components/schemas/EhrPatientList'
    EhrPatientList:
      type: object
      properties:
        listId:
          type: array
          description: The Fhir Id of the List resource for the EHR endpoint
          example: euj5ULD0SRDdVTh-PiN0IUYAXZGLNFfFXKetvxENyFeT6Np3ZuIULYMArJUgUYL-H3 (Used in the following request - {fhirServerBase}/List/{listId})
          items:
            type: string
        measureId:
          type: array
          example: NHSNGlycemicControlHypoglycemicInitialPopulation
          items:
            type: string
    FhirQuery:
      type: object
      properties:
        fhirServerBase:
          type: string
          description: The URL to the facility FHIR endpoint
        authClass:
          type: string
          description: 'The class that should be used (if any) to authenticate queries to the EHR''s FHIR server.'
          enum:
            - com.lantanagroup.link.query.auth.BasicAuth
            - com.lantanagroup.link.query.auth.BasicAuthAndApiKeyHeader
            - com.lantanagroup.link.query.auth.AzureAuth
            - com.lantanagroup.link.query.auth.CernerAuth
            - com.lantanagroup.link.query.auth.EpicAuth
            - com.lantanagroup.link.query.auth.TokenAuth
        parallelPatients:
          type: number
          description: 'The number of patients to query for in parallel using separate threads. Should not be greater than the number of cores available to the installation.'
        basicAuth:
          allOf:
            - $ref: '#/components/schemas/BasicAuth'
            - description: 'Configuration used by BasicAuth implementation'
        basicAuthAndApiKey:
          allOf:
            - $ref: '#/components/schemas/BasicAuthAndApiKey'
            - description: 'Configuration used by basicAuthAndApiKeyHeader implementation'
        tokenAuth:
          allOf:
            - $ref: '#/components/schemas/TokenAuth'
            - description: 'Configuration used by TokenAuth implementation'
        azureAuth:
          allOf:
            - $ref: '#/components/schemas/AzureAuth'
            - description: 'Configuration used by AzureAuth implementation'
        cernerAuth:
          allOf:
            - $ref: '#/components/schemas/CernerAuth'
            - description: 'Configuration used by CernerAuth implementation'
        epicAuth:
          allOf:
            - $ref: '#/components/schemas/EpicAuth'
            - description: 'Configuration used by EpicAuth implementation'
        queryPlans:
          type: object
          properties:
            measureId:
              $ref: '#/components/schemas/QueryPlan'
    BasicAuth:
      type: object
      properties:
        username:
          type: string
        password:
          type: string
    BasicAuthAndApiKey:
      type: object
      properties:
        username:
          type: string
        password:
          type: string
        apiKey:
          type: string
    AzureAuth:
      type: object
      properties:
        tokenUrl:
          type: string
        clientId:
          type: string
        secret:
          type: string
        resource:
          type: string
    TokenAuth:
      type: object
      properties:
        token:
          type: string
    CernerAuth:
      type: object
      properties:
        tokenUrl:
          type: string
        clientId:
          type: string
        secret:
          type: string
        scopes:
          type: string
    EpicAuth:
      type: object
      properties:
        key:
          type: string
          description: The key that should be used to sign the JWT generated by Link to send in the Authorization header to the tokenUrl
        tokenUrl:
          type: string
        clientId:
          type: string
        audience:
          type: string
    ReportingPlan:
      type: object
      required:
        - url
        - nhsnOrgId
        - planNames
      properties:
        enabled:
          type: boolean
          default: false
        url:
          type: string
        nhsnOrgId:
          type: string
        planNames:
          type: object
          required:
            - measureId
          properties:
            measureId:
              type: string
              description: Key is the  measure id registered in Link, value is the NHSN plan ID
              example: nhsnPlanId
    QueryPlan:
      type: object
      properties:
        lookback:
          type: string
          description: The query look back period in Java Period format (PnYnMnDTnHnMnS).
          example: P20Y3M20D (20 years, 3 months and 20 days) P1W (1 week)
        initial:
          type: array
          description: The query plan for resources that are required to determine if the patient is a part of the initial population of a measure
          items:
            $ref: '#/components/schemas/TypedQueryPlan'
        supplemental:
          type: array
          description: The query plan for additional resources that need to be applied to patients that are part of the initial population of a measure.
          items:
            $ref: '#/components/schemas/TypedQueryPlan'
    TypedQueryPlan:
      type: object
      properties:
        resourceType:
          type: string
          description: The FHIR resource to query
          example: Encounter
        parameters:
          type: array
          description: Supported parameters applied to the resource query request
          items:
            $ref: '#/components/schemas/ParameterConfig'
          example: GET [base]?parameter(s)
        references:
          $ref: '#/components/schemas/ReferencesConfig'
        earlyExit:
          type: boolean
    ReferencesConfig:
      type: object
      properties:
        operationType:
          type: string
          enum:
            - READ
            - SEARCH
        paged:
          type: number
    ParameterConfig:
      type: object
      description: The supported resource parameter applied to query
      example: Encounter resource parameter - https://build.fhir.org/encounter-search.html
      properties:
        name:
          type: string
          description: The resource search parameter name
          example: date
        literal:
          description: The actual value used for the search parameter
          type: string
        variable:
          type: string
          description: The internal Link variable value used for the search parameter
          example: patientid, lookbackstart, periodstart, periodend
        format:
          type: string
          description: The format to apply to the 'variable' parameterConfig type
          example: ge%s (Using 'greater than' for lookBackStart) le%s (Using 'less' than for period end)
        ids:
          type: string
          description: The value of a resource type that's already been queried.  The resource type defined here should be defined earlier in the query plan.  Link collects the IDs of those previously queried resources and uses them as a search parameter for the resource type in question.
          example: Encounter
        paged:
          type: number
          description: The total number of resources returned by the query
    User:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        enabled:
          type: boolean
    FHIR.ConceptMap:
      type: object
    FHIR.MeasureReport:
      type: object
    FHIR.Bundle:
      type: object
    FHIR.BulkCreateUserOperationOutcome:
      type: object
      example: {
        "issue": [ {
          "severity": "info",
          "diagnostics": "Successfully created user with email XX@YY.com"
        }, {
          "severity": "error",
          "diagnostics": "Error creating user with email AA@BB.com: A user with that email already exists"
        } ]
      }
      properties:
        extension:
          type: array
          items:
            $ref: '#/components/schemas/FHIR.Extension'
        issue:
          type: array
          items:
            $ref: '#/components/schemas/FHIR.OperationOutcomeIssue'
    FHIR.OperationOutcome:
      type: object
      properties:
        extension:
          type: array
          items:
            $ref: '#/components/schemas/FHIR.Extension'
        issue:
          type: array
          items:
            $ref: '#/components/schemas/FHIR.OperationOutcomeIssue'
    FHIR.OperationOutcomeIssue:
      type: object
      properties:
        severity:
          type: string
        code:
          type: string
        diagnostics:
          type: string
        location:
          type: array
          items:
            type: string
    FHIR.Extension:
      type: object
      properties:
        url:
          type: string
        valueInteger:
          type: number
    Error:
      type: object
      properties:
        code:
          type: string
        message:
          type: string
      required:
        - code
        - message
  securitySchemes:
    oauth:
      type: oauth2
      flows:
        authorizationCode:
          authorizationUrl: ''
          tokenUrl: ''
          scopes: { }
    basic:
      type: http
      scheme: basic
  responses:
    NotFound:
      description: The specified resource was not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
    Unauthorized:
      description: Unauthorized
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'